{% with rounds=rounds %}
  {% include "tab_all.html" %}
{% endwith %}

<div>
  <form class="bg-gray-100" hx-post="/round_update/{{round_id}}" hx-target="#tabs" hx-swap="innerHTML">
    <p class="text-lg text-center">Fill in round results for round: {{round_id}}</p>
    <div class="p-3 w-9/12 m-auto">
    {% for m in matchups %}
    <div class="flex gap-2">
      <div class="basis-1/6 text-right">
        <label for="matchup_input_{{m.white_identifier}}">{{m.white_full_name}}</label>
      </div>
      <div class="flex ml-20">
        <select
          id="matchup_input_{{m.white_identifier}}"
          _="on change put white_black_result_map[me.value] into #matchup_result_black_{{m.black_identifier}} then put white_black_result_map[me.value] into #matchup_result_black_{{m.black_identifier}}_input.value"
          name="matchup_input_{{m.white_identifier}}">
            <option value="unset" {{'selected' if (m.white_score|default('unset')) == 'unset'}}>unset</option>
            <option value="1" {{'selected' if (m.white_score|default('unset')) == 1}}>1</option>
            <option value="0" {{'selected' if (m.white_score|default('unset')) == 0}}>0</option>
            <option value="0.5" {{'selected' if (m.white_score|default('unset')) == 0.5}}>0.5</option>
        </select>
      </div>
      <div class="flex mr-20">
        <p
          class="w-6"
          id="matchup_result_black_{{m.black_identifier}}">{{m.black_score|default('unset')}}
        </p>
        <input
          id="matchup_result_black_{{m.black_identifier}}_input"
          type="hidden"
          name="matchup_result_black_{{m.black_identifier}}"
          value="{{m.black_score|default('unset')}}"
        />
      </div>
      <div>
        <p id="matchup_full_name_black_{{m.black_identifier}}">{{m.black_full_name}}</p>
      </div>
    </div>
    {% endfor %}
    <input
      class=""
        _="on click if #round-status.innerHTML matches 'finished' then remove .invisible from #generate-round"
        log #round-status.innerHTML"
      type="submit"
      value="Submit"
    >
    </div>
  </form>
  <p
    _="on change if me.innerHTML matches 'finished' then remove .invisible from #generate-round"
    class="hidden"
    id="round-status"
    >{{'in progress' if not is_complete else  'finished'}}
  </p>
  {% if rounds|length == (round_id) %}
    {% if is_complete and not is_last_round%}
      <button
        id="generate-round"
        hx-get="/generate_round/{{round_id + 1}}"
        hx-trigger="click"
        hx-swap="innerHTML"
        hx-target="#tabs"
      >
        Generate Next Round
      </button>
    {% endif %}
  {% endif %}

  <div class="m-72"></div>
  <form
    class=""
    hx-post="/upload_round_csv/{{round_id}}"
    hx-target="#tabs"
    hx-swap="innerHTML"
    hx-encoding="multipart/form-data"
  >
    <label for="file">FORCE OVERWRITE FROM CSV</label>
    <input
      id="read-round-from-csv"
      name="file"
      type="file"
      accept=".csv"
      required
    >
    <input
      class=""
      type="submit"
      value="Submit"
    >
  </form>
</div>

<script>
var white_black_result_map = {
  "1": "0",
  "0": "1",
  "0.5": "0.5",
  "unset": "unset",
};
</script>
